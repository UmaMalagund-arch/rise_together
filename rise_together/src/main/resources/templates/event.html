<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>NGO Dashboard - Events</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      display: flex;
      height: 100vh;
      background-color: #f4f4f4;
    }

    .sidebar {
      width: 260px;
      background-color: rgb(48, 1, 75);
      color: white;
      padding: 24px 20px;
      display: flex;
      flex-direction: column;
    }

    .sidebar h2 {
      margin-bottom: 30px;
      font-size: 22px;
      text-align: center;
    }

    .sidebar div,
    .sidebar a>div {
      cursor: pointer;
      color: white;
      padding: 14px 15px;
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      border-radius: 8px;
      transition: background 0.3s;
      font-size: 16px;
    }

    .sidebar div:hover,
    .sidebar a>div:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .sidebar i {
      margin-right: 12px;
      font-size: 18px;
    }

    .sidebar .fa-clipboard-list {
      color: #ffcc00;
    }

    .sidebar .fa-donate {
      color: #4caf50;
    }

    .sidebar .fa-calendar-alt {
      color: #2196f3;
    }

    .sidebar .fa-sign-out-alt {
      color: #f44336;
    }

    .main-content {
      flex-grow: 1;
      padding: 30px;
      overflow-y: auto;
    }

    /* New Event Section Styles */
    .event-form {
      display: none;
      max-width: 500px;
      margin: auto;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .event-card {
      width: 300px;
      height: 400px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin: 10px;
      display: inline-block;
      vertical-align: top;
    }

    
  .modal {
    display: none;
    position: fixed;
    z-index: 10;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
  }

  .modal-content {
    background: white;
    margin: 10% auto;
    padding: 20px;
    width: 50%;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .blur {
    filter: blur(5px);
  }

  .close {
    float: right;
    font-size: 24px;
    cursor: pointer;
  }
.blur {
  filter: blur(5px);
  pointer-events: none;
}
.blur {
  filter: blur(5px);
  pointer-events: none;
  user-select: none;
}

/* Ensure the form stays sharp and above */
.form-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 999; /* higher than the blurred content */
  background-color: white;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Optional overlay for dimming effect */
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  z-index: 998;
  display: none; /* will show when form is open */
}

#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.4);
  z-index: 998;
  display: none;
}
.modal-content{
  width: 35%;
}

  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>NGO Panel</h2>
    <a th:href="@{/ngo/home/ngoPage}" style="text-decoration:none; color: white;"><div><i class="fas fa-hand-holding-heart"></i>NGO</div></a>
    <a th:href="@{/ngo/home/reports}" style="text-decoration:none;"><div><i class="fas fa-clipboard-list"></i>Reports</div></a>
    <div onclick="showSection('donations')"><i class="fas fa-donate"></i> Donation Summary</div>
    <a th:href="@{/ngo/home/event}" style="text-decoration:none; color: white;"><div><i class="fas fa-calendar-alt"></i> Events</div> </a>
    <a th:href="@{/logout}" style="text-decoration:none; color: white;">
      <div><i class="fas fa-sign-out-alt"></i> Logout</div>
    </a>
  </div>

  <!-- Events Section -->
  <div id="events" class="main-content main-section">
    <h1 style="text-align:start; font-size: 40px; color: rgb(48,1,75)">Campaigns</h1>

    <!-- Add Event Button -->
    <div style="text-align: start; margin-bottom: 20px;">
      <button onclick="openForm()"
        style="padding: 10px 20px; font-size: 16px; background-color: rgb(48,1,75); color: white; border: none; border-radius: 8px; cursor: pointer;">
        âž• Add Event
      </button>
    </div>

    <!-- Event Form -->
    <div id="eventForm" class="event-form">
      <h2 style="text-align:center; color:rgb(48,1,75);">Add New Event</h2>
      <form action="/ngo/home/event" method="post">
        <label>Event Title:</label>
        <input type="text" name="eventName" style="width:100%; padding:8px; margin-bottom:10px;">

        <label>Description:</label>
        <textarea name="description" rows="4" style="width:100%; padding:8px; margin-bottom:10px;"></textarea>

        <label>Pincode:</label>
        <input type="text" name="pincode" style="width:100%; padding:8px; margin-bottom:15px;">

        <label>Location:</label>
        <textarea name="location" rows="2" style="width:100%; padding:8px; margin-bottom:10px;"></textarea>

        <label>Date:</label>
        <input type="date" name="date" style="width:100%; padding:8px; margin-bottom:15px;">

        <div style="text-align:center;">
          <button type="submit" onclick="closeForm()"
            style="padding:10px 20px; background-color:rgb(48,1,75); color:white; border:none; border-radius:6px;">
            Add
          </button>
          <button type="button" onclick="closeForm()"
            style="padding:10px 20px; background-color:#dc3545;color:white; border:none; border-radius:6px; margin-left:10px;">
            Cancel
          </button>
        </div>
      </form>
    </div>

    <!-- Event Cards -->
     <div id="eventCards" style="display: flex;">
    <div th:if="${events}" th:each="event : ${events}" style="display: flex; flex-wrap: wrap;">
      <div class="event-card">
        <h3 style="color:rgb(13, 175, 7); text-align: center; font-weight: bolder;" th:text="${event.eventName}">Event Title Here</h3><br><br>
        <div><strong>Description:</strong> <span th:text="${event.description}">Description goes here</span></div> <br>
        <div><strong>Location:</strong> <span th:text="${event.location}">Location info</span></div><br>
        <div><strong>pincode:</strong> <span th:text="${event.pincode}">Location info</span></div><br>
        <div><strong>Date:</strong> <span th:text="${event.date}">Date info</span></div><br>
        <div>
          <strong>Status:</strong>
          <button style="background-color:#ffc107; border:none; padding:5px 10px; border-radius:5px; color:black; position: relative;left: 15px;"th:text="Pending">Pending</button>
        </div><br><br><br>
        <div >
          <center>
  <button class="edit-btn"
  th:data-id="${event.id}"
  th:data-name="${event.eventName}"
  th:data-description="${event.description}"
  th:data-pincode="${event.pincode}"
  th:data-location="${event.location}"
  th:data-date="${event.date != null ? #temporals.format(event.date, 'yyyy-MM-dd') : ''}"
  onclick="handleEditClick(this)" style="height:  30px; width: 35%; background-color: rgb(48, 1, 75);color:white; border:none; border-radius:5px; position: relative; left: -50px;">Edit</button>


          <form th:action="@{'/ngo/home/event/delete/' + ${event.id}}" method="post" style="margin-top: 10px;">
    <button type="submit" onclick="return confirm('Are you sure you want to delete this event?')"  style="height:  30px; width: 35%; background-color: rgb(206, 41, 60);color:white; border:none; border-radius:5px;position: relative; top: -40px;left: 50px;">Delete</button>
  </form>
        </center>
        </div>
      </div>
    </div>
    </div>

  </div>
  <!--EditForm  -->
    <!-- Modal Form for Editing -->
<div id="eventFormModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeEditForm()">&times;</span>
    <h2 style="color:rgb(48,1,75);">Update Event</h2>
    <form id="editForm" th:action="@{/ngo/home/event/update}" method="post">
      <input type="hidden" id="editId" name="id" />
      
      <label>Event Title:</label>
      <input type="text" id="editEventName" name="eventName"  style="width:100%; padding:8px; margin-bottom:10px;">

      <label>Description:</label>
      <textarea id="editDescription" name="description" rows="4"  style="width:100%; padding:8px; margin-bottom:10px;"></textarea>

      <label>Pincode:</label>
      <input type="text" id="editPincode" name="pincode"  style="width:100%; padding:8px; margin-bottom:15px;">

      <label>Location:</label>
      <textarea id="editLocation" name="location" rows="2"  style="width:100%; padding:8px; margin-bottom:10px;"></textarea>

      <label>Date:</label>
      <input type="date" id="editDate" name="date" style="width:100%; padding:8px; margin-bottom:15px;">

      <div style="text-align:center;">
        <button type="submit" style="padding:10px 20px; background-color:rgb(48,1,75); color:white; border:none; border-radius:6px;">Update</button>
        <button type="button" onclick="closeEditForm()" style="padding:10px 20px; background-color:#dc3545; color:white; border:none; border-radius:6px; margin-left:10px;">Cancel</button>
      </div>
    </form>
    
  </div>
</div>


<div id="overlay"></div>

  <!-- JavaScript -->
  <script>
  // Show the Add form and blur background
  function openForm() {
  document.getElementById('eventForm').style.display = 'block';
  document.getElementById('eventCards').style.display = 'none';
}

function closeForm() {
  document.getElementById('eventForm').style.display = 'none';
  document.getElementById('eventCards').style.display = 'flex';
}


  // Show the Edit form and blur background
  function openEditForm(id, name, description, pincode, location, date) {
    document.getElementById("events").classList.add("blur");
    document.getElementById("eventFormModal").style.display = "block";

    // Populate form fields
    document.getElementById("editId").value = id;
    document.getElementById("editEventName").value = name;
    document.getElementById("editDescription").value = description;
    document.getElementById("editPincode").value = pincode;
    document.getElementById("editLocation").value = location;
    document.getElementById("editDate").value = date;
  }

  // ðŸ‘‡ THIS WAS YOUR MISSING LINK â€“ handle button click and extract values
  function handleEditClick(button) {
    const id = button.dataset.id;
    const name = button.dataset.name;
    const description = button.dataset.description;
    const pincode = button.dataset.pincode;
    const location = button.dataset.location;
    const date = button.dataset.date;

    openEditForm(id, name, description, pincode, location, date);
  }

  function closeEditForm() {
    document.getElementById("events").classList.remove("blur");
    document.getElementById("eventFormModal").style.display = "none";
  }
</script>

</body>

</html>